<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>業者見積データベース</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="styles.css" rel="stylesheet" />
  </head>
  <body>
    <nav
      class="navbar navbar-dark bg-dark px-3"
      style="height: var(--header-height)"
    >
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <svg
          class="icon-lg"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
          />
          <polyline points="7.5 4.21 12 6.81 16.5 4.21" />
          <polyline points="7.5 19.79 7.5 14.6 3 12" />
          <polyline points="21 12 16.5 14.6 16.5 19.79" />
          <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
          <line x1="12" y1="22.08" x2="12" y2="12" />
        </svg>
        <span class="fw-bold">業者見積データベース</span>
      </a>
    </nav>

    <div class="d-flex flex-column flex-lg-row">
      <aside class="sidebar d-flex flex-column bg-white">
        <div class="p-3 border-bottom">
          <h6
            class="mb-0 fw-bold text-secondary d-flex align-items-center gap-1"
          >
            <svg
              class="icon"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            検索条件
          </h6>
        </div>
        <div class="p-3 flex-grow-1">
          <div class="mb-2">
            <h6 class="fw-bold text-secondary mb-0" style="font-size: 0.75rem">
              案件情報
            </h6>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >案件名</label
            >
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="キーワード検索"
              id="filterProject"
            />
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >建物用途</label
            >
            <select class="form-select form-select-sm" id="filterUsage">
              <option value="">すべて</option>
              <option>事務所</option>
              <option>店舗</option>
              <option>共同住宅</option>
              <option>工場</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary">構造</label>
            <div class="d-flex flex-wrap gap-2">
              <div class="form-check">
                <input
                  class="form-check-input filter-structure"
                  type="checkbox"
                  value="RC"
                  id="rc"
                />
                <label class="form-check-label small" for="rc">RC</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input filter-structure"
                  type="checkbox"
                  value="S"
                  id="s"
                />
                <label class="form-check-label small" for="s">S</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input filter-structure"
                  type="checkbox"
                  value="SRC"
                  id="src"
                />
                <label class="form-check-label small" for="src">SRC</label>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >延床面積 (㎡)</label
            >
            <div class="input-group input-group-sm">
              <input
                type="number"
                class="form-control"
                placeholder="最小"
                id="filterAreaMin"
              />
              <span class="input-group-text">~</span>
              <input
                type="number"
                class="form-control"
                placeholder="最大"
                id="filterAreaMax"
              />
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >見積期間</label
            >
            <div class="input-group input-group-sm">
              <input type="date" class="form-control" id="filterDateFrom" />
              <span class="input-group-text">~</span>
              <input type="date" class="form-control" id="filterDateTo" />
            </div>
          </div>
          <hr />
          <div class="mb-2">
            <h6 class="fw-bold text-secondary mb-0" style="font-size: 0.75rem">
              見積情報
            </h6>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >品目・仕様</label
            >
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="キーワード検索"
              id="filterItem"
            />
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary">工種</label>
            <select class="form-select form-select-sm" id="filterCategory">
              <option value="">すべて</option>
              <option value="rebar">鉄筋工事</option>
              <option value="earthwork">土工事</option>
              <option value="painting">塗装工事</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >協力会社名</label
            >
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="会社名"
              id="filterCompany"
            />
          </div>
        </div>
        <div class="p-3 border-top bg-light">
          <div class="d-grid gap-2">
            <button class="btn btn-primary" onclick="applyFilters()">
              検索実行
            </button>
            <button
              class="btn btn-outline-secondary btn-sm"
              onclick="clearFilters()"
            >
              条件クリア
            </button>
          </div>
        </div>
      </aside>
      <script>
        document
          .querySelector(".sidebar")
          .addEventListener("keydown", function (e) {
            if (
              e.key === "Enter" &&
              (e.target.tagName === "INPUT" || e.target.tagName === "SELECT")
            ) {
              e.preventDefault();
              applyFilters();
            }
          });
      </script>

      <main class="main-content p-4">
        <div class="mb-4">
          <h4 class="fw-bold mb-3">検索結果一覧</h4>
          <div
            class="d-flex gap-2 align-items-center flex-wrap mb-3"
            id="activeFilters"
          ></div>
        </div>

        <div id="resultsContainer"></div>
      </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script type="module" src="scripts/ui/app.js"></script>

    <!-- NET単価実績チャートモーダル -->
    <div class="modal fade" id="chartModal" tabindex="-1">
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
          <!-- Header -->
          <div class="modal-header py-2">
            <div class="d-flex flex-column">
              <h5 class="modal-title fw-bold mb-0">
                <svg
                  class="icon-inline me-2"
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                >
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                </svg>
                <span id="chartModalTitle">NET単価推移</span>
              </h5>
            </div>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <!-- Filter Bar -->
          <div class="bg-light border-bottom py-2 px-3">
            <div class="d-flex align-items-center gap-3 flex-wrap">
              <!-- Date Range Filter -->
              <div class="d-flex align-items-center gap-1">
                <label class="form-label small mb-0 text-muted fw-semibold">期間:</label>
                <div class="input-group input-group-sm" style="width: auto">
                  <input
                    type="date"
                    class="form-control form-control-sm"
                    id="chartDateFrom"
                  />
                  <span class="input-group-text">~</span>
                  <input
                    type="date"
                    class="form-control form-control-sm"
                    id="chartDateTo"
                  />
                </div>
              </div>
              <!-- Time Unit Filter -->
              <div class="d-flex align-items-center gap-1">
                <label class="form-label small mb-0 text-muted fw-semibold">時間軸:</label>
                <select class="form-select form-select-sm" style="width: auto" id="chartTimeUnit">
                  <option value="yearly">年次</option>
                  <option value="monthly" selected>月次</option>
                  <option value="weekly">週次</option>
                  <option value="daily">日次</option>
                </select>
              </div>
              <!-- Display Mode Filter -->
              <div class="d-flex align-items-center gap-1">
                <label class="form-label small mb-0 text-muted fw-semibold">表示:</label>
                <select class="form-select form-select-sm" style="width: auto" id="chartDisplayMode">
                  <option value="line" selected>折れ線</option>
                  <option value="table">テーブル</option>
                </select>
              </div>
              <!-- Clear Filters -->
              <button
                type="button"
                class="btn btn-outline-secondary btn-sm"
                id="chartClearFilters"
              >
                クリア
              </button>
              <!-- KPI Summary (right side) -->
              <div class="d-flex gap-2 gap-md-3 align-items-center flex-wrap ms-auto">
                <span class="badge bg-info" id="chartRecordCount">0件</span>
                <small class="text-muted">最小:</small>
                <span class="fw-semibold text-success small" id="chartMinPrice">-</span>
                <small class="text-muted">平均:</small>
                <span class="fw-semibold text-primary small" id="chartAvgPrice">-</span>
                <small class="text-muted">中央値:</small>
                <span class="fw-semibold text-warning small" id="chartMedianPrice">-</span>
                <small class="text-muted">最大:</small>
                <span class="fw-semibold text-danger small" id="chartMaxPrice">-</span>
              </div>
            </div>
          </div>

          <!-- Modal Body -->
          <div class="modal-body p-3 bg-body-secondary overflow-auto">
            <!-- Chart Section -->
            <div class="card shadow-sm mb-3" id="chartSection">
              <div class="card-header bg-white py-2 d-flex justify-content-between align-items-center">
                <h6 class="mb-0 fw-bold text-secondary d-flex align-items-center gap-2">
                  <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                  </svg>
                  NET単価推移グラフ
                </h6>
                <div class="d-flex align-items-center gap-2">
                  <span class="small text-muted" id="chartItemName">-</span>
                  <span class="badge bg-secondary small" id="chartUnit">-</span>
                </div>
              </div>
              <div class="card-body">
                <div class="chart-container">
                  <canvas id="netPriceChart"></canvas>
                </div>
              </div>
            </div>

            <!-- Table Section -->
            <div class="card shadow-sm" id="tableSection">
              <div class="card-header bg-white py-2 d-flex justify-content-between align-items-center">
                <h6 class="mb-0 fw-bold text-secondary d-flex align-items-center gap-2">
                  <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" />
                    <path d="M3 9h18" />
                    <path d="M9 21V9" />
                  </svg>
                  見積詳細データ
                </h6>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-sm table-bordered table-hover mb-0" id="chartDataTable">
                    <thead class="table-light">
                      <tr>
                        <th class="text-center">見積時期</th>
                        <th>案件名</th>
                        <th>協力会社</th>
                        <th class="text-end">NET単価</th>
                        <th class="text-end">NET率</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer py-2">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              閉じる
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
