<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>業者見積データベース</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --sidebar-width: 280px;
        --header-height: 56px;
      }
      body {
        background: #f8f9fa;
      }
      .icon {
        width: 16px;
        height: 16px;
        vertical-align: -2px;
      }
      .icon-sm {
        width: 14px;
        height: 14px;
      }
      .icon-lg {
        width: 20px;
        height: 20px;
      }
      .sidebar {
        width: var(--sidebar-width);
        height: calc(100vh - var(--header-height));
        overflow-y: auto;
      }
      .main-content {
        height: calc(100vh - var(--header-height));
        overflow-y: auto;
        flex: 1;
      }
      .tabular-nums {
        font-variant-numeric: tabular-nums;
      }
      .subcategory-btn {
        min-width: 130px;
        text-align: left;
      }
      .subcategory-btn.active {
        background-color: #e7f1ff !important;
        border-color: #0d6efd !important;
        color: #0a58ca !important;
      }
      .subcategory-btn .sub-label {
        font-size: 0.7rem;
        opacity: 0.7;
      }
      .subcategory-btn .sub-amount {
        font-size: 0.875rem;
        font-weight: 700;
      }
      .table-estimate thead th {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 5;
      }
      .table-estimate tbody td {
        vertical-align: middle;
        font-size: 0.875rem;
      }
      .col-net {
        background: rgba(25, 135, 84, 0.05);
      }
      .col-price {
        background: rgba(13, 110, 253, 0.05);
      }
      .summary-card {
        border-left: 4px solid #0d6efd;
      }
      .scroll-x {
        overflow-x: auto;
      }
      .form-label-sm {
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
    </style>
  </head>
  <body>
    <nav
      class="navbar navbar-dark bg-dark px-3"
      style="height: var(--header-height)"
    >
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <svg
          class="icon-lg"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <ellipse cx="12" cy="5" rx="9" ry="3" />
          <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" />
          <path d="M3 12c0 1.66 4 3 9 3s9-1.34 9-3" />
        </svg>
        <span class="fw-bold">業者見積データベース</span>
      </a>
    </nav>

    <div class="d-flex">
      <aside class="sidebar d-none d-lg-flex flex-column bg-white border-end">
        <div class="p-3 border-bottom">
          <h6
            class="mb-0 fw-bold text-secondary d-flex align-items-center gap-1"
          >
            <svg
              class="icon"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            検索条件
          </h6>
        </div>
        <div class="p-3 flex-grow-1">
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >案件名・キーワード</label
            >
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="例: ○○ビル改修工事"
            />
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >建物用途</label
            >
            <select class="form-select form-select-sm">
              <option value="">すべて</option>
              <option>事務所</option>
              <option>店舗</option>
              <option>共同住宅</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary">構造</label>
            <div class="d-flex flex-wrap gap-2">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="rc" /><label
                  class="form-check-label small"
                  for="rc"
                  >RC</label
                >
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="s" /><label
                  class="form-check-label small"
                  for="s"
                  >S</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="src"
                /><label class="form-check-label small" for="src">SRC</label>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >延床面積 (㎡)</label
            >
            <div class="input-group input-group-sm">
              <input type="number" class="form-control" placeholder="最小" />
              <span class="input-group-text">~</span>
              <input type="number" class="form-control" placeholder="最大" />
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >見積期間</label
            >
            <div class="input-group input-group-sm">
              <input type="date" class="form-control" />
              <span class="input-group-text">~</span>
              <input type="date" class="form-control" />
            </div>
          </div>
          <hr class="my-3" />
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >協力会社名</label
            >
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="会社名"
            />
          </div>
          <div class="mb-3">
            <label class="form-label form-label-sm text-secondary"
              >品目・仕様</label
            >
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="品目名など"
            />
          </div>
        </div>
        <div class="p-3 border-top bg-light">
          <div class="d-grid gap-2">
            <button class="btn btn-secondary">検索実行</button>
            <button class="btn btn-outline-secondary btn-sm">条件クリア</button>
          </div>
        </div>
      </aside>

      <main class="main-content p-4">
        <div class="mb-4">
          <h4 class="fw-bold mb-1">案件検索結果</h4>
          <p class="text-muted mb-0 small">
            該当: <span class="text-primary fw-bold fs-5">2</span> 件
          </p>
        </div>
        <div id="projectsContainer"></div>
      </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script>
      const icons = {
        chevronDown:
          '<svg class="icon-sm" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>',
        chevronUp:
          '<svg class="icon-sm" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>',
        filter:
          '<svg class="icon-sm" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>',
        expand:
          '<svg class="icon-sm" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>',
        inbox:
          '<svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>',
      };
      const fmt = (n) => (n ? n.toLocaleString() : "0");
      const catNames = {
        rebar: "鉄筋工事",
        earthwork: "土工事",
        painting: "塗装工事",
      };

      const projects = [
        {
          id: "p1",
          name: "港区芝浦 Aビル大規模改修工事",
          shortName: "港区芝浦 Aビル...",
          type: "事務所",
          typeColor: "primary",
          structure: "SRC造",
          area: "15,200",
          period: "2023/09/01 ~ 2023/10/31",
          totalEstimate: 125000000,
          totalNet: 98500000,
          data: {
            rebar: [
              {
                type: "major",
                category: "材料費",
                amount: 23085734,
                netAmount: 19500000,
              },
              {
                type: "major",
                category: "加工・組立費",
                amount: 19070547,
                netAmount: 15100000,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 A社",
                item: "異形棒鋼 SD295A",
                spec: "D10",
                remark: "",
                qty: 57.457,
                unit: "t",
                price: 110000,
                amount: 6320270,
                netRate: 0.98,
                netPrice: 107800,
                netAmount: 6193865,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 A社",
                item: "異形棒鋼 SD295A",
                spec: "D13",
                remark: "",
                qty: 41.183,
                unit: "t",
                price: 108000,
                amount: 4447764,
                netRate: 0.98,
                netPrice: 105840,
                netAmount: 4358809,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 A社",
                item: "異形棒鋼 SD345",
                spec: "D16",
                remark: "",
                qty: 85.2,
                unit: "t",
                price: 115000,
                amount: 9798000,
                netRate: 0.98,
                netPrice: 112700,
                netAmount: 9602040,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 B社",
                item: "高強度鉄筋 SD490",
                spec: "D25",
                remark: "",
                qty: 7.11,
                unit: "t",
                price: 270000,
                amount: 1919700,
                netRate: 0.98,
                netPrice: 264600,
                netAmount: 1881306,
              },
              {
                type: "indirect",
                category: "材料費",
                company: "株式会社 A社",
                item: "材料運搬費",
                spec: "",
                remark: "現場搬入",
                qty: 1,
                unit: "式",
                price: 580000,
                amount: 580000,
                netRate: 0.98,
                netPrice: 568400,
                netAmount: 568400,
              },
              {
                type: "indirect",
                category: "材料費",
                company: "株式会社 A社",
                item: "材料保管費",
                spec: "",
                remark: "仮置場",
                qty: 1,
                unit: "式",
                price: 120000,
                amount: 120000,
                netRate: 0.98,
                netPrice: 117600,
                netAmount: 117600,
              },
              {
                type: "direct",
                category: "加工・組立費",
                company: "株式会社 C社",
                item: "鉄筋加工費",
                spec: "",
                remark: "工場加工",
                qty: 226.111,
                unit: "t",
                price: 35000,
                amount: 7913885,
                netRate: 0.95,
                netPrice: 33250,
                netAmount: 7518190,
              },
              {
                type: "direct",
                category: "加工・組立費",
                company: "株式会社 C社",
                item: "鉄筋組立費",
                spec: "",
                remark: "現場組立",
                qty: 226.111,
                unit: "t",
                price: 42000,
                amount: 9496662,
                netRate: 0.95,
                netPrice: 39900,
                netAmount: 9021829,
              },
              {
                type: "direct",
                category: "加工・組立費",
                company: "株式会社 C社",
                item: "圧接工事",
                spec: "D25以上",
                remark: "",
                qty: 450,
                unit: "箇所",
                price: 1800,
                amount: 810000,
                netRate: 0.95,
                netPrice: 1710,
                netAmount: 769500,
              },
              {
                type: "indirect",
                category: "加工・組立費",
                company: "株式会社 C社",
                item: "現場管理費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 850000,
                amount: 850000,
                netRate: 0.95,
                netPrice: 807500,
                netAmount: 807500,
              },
              {
                type: "legal",
                category: "加工・組立費",
                company: "株式会社 C社",
                item: "労災保険料",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 320000,
                amount: 320000,
                netRate: 0.95,
                netPrice: 304000,
                netAmount: 304000,
              },
            ],
            earthwork: [
              {
                type: "major",
                category: "掘削工事",
                amount: 20000000,
                netAmount: 15500000,
              },
              {
                type: "major",
                category: "残土処分",
                amount: 8745000,
                netAmount: 7000000,
              },
              {
                type: "direct",
                category: "掘削工事",
                company: "株式会社 D社",
                item: "根切り工事",
                spec: "機械掘削",
                remark: "バックホウ",
                qty: 2500,
                unit: "㎥",
                price: 3500,
                amount: 8750000,
                netRate: 0.92,
                netPrice: 3220,
                netAmount: 8050000,
              },
              {
                type: "direct",
                category: "掘削工事",
                company: "株式会社 D社",
                item: "床付け工事",
                spec: "",
                remark: "",
                qty: 1200,
                unit: "㎡",
                price: 850,
                amount: 1020000,
                netRate: 0.92,
                netPrice: 782,
                netAmount: 938400,
              },
              {
                type: "direct",
                category: "掘削工事",
                company: "株式会社 E社",
                item: "山留め工事",
                spec: "H鋼＋横矢板",
                remark: "",
                qty: 380,
                unit: "m",
                price: 25000,
                amount: 9500000,
                netRate: 0.92,
                netPrice: 23000,
                netAmount: 8740000,
              },
              {
                type: "indirect",
                category: "掘削工事",
                company: "株式会社 D社",
                item: "重機回送費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 450000,
                amount: 450000,
                netRate: 0.92,
                netPrice: 414000,
                netAmount: 414000,
              },
              {
                type: "legal",
                category: "掘削工事",
                company: "株式会社 D社",
                item: "安全対策費",
                spec: "",
                remark: "法定",
                qty: 1,
                unit: "式",
                price: 280000,
                amount: 280000,
                netRate: 0.92,
                netPrice: 257600,
                netAmount: 257600,
              },
              {
                type: "direct",
                category: "残土処分",
                company: "株式会社 F社",
                item: "残土運搬",
                spec: "10tダンプ",
                remark: "",
                qty: 3200,
                unit: "㎥",
                price: 1800,
                amount: 5760000,
                netRate: 0.95,
                netPrice: 1710,
                netAmount: 5472000,
              },
              {
                type: "direct",
                category: "残土処分",
                company: "株式会社 F社",
                item: "残土処分費",
                spec: "第1種建設発生土",
                remark: "",
                qty: 3200,
                unit: "㎥",
                price: 850,
                amount: 2720000,
                netRate: 0.95,
                netPrice: 807,
                netAmount: 2582400,
              },
              {
                type: "indirect",
                category: "残土処分",
                company: "株式会社 F社",
                item: "処分場管理費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 180000,
                amount: 180000,
                netRate: 0.95,
                netPrice: 171000,
                netAmount: 171000,
              },
              {
                type: "legal",
                category: "残土処分",
                company: "株式会社 F社",
                item: "産廃管理票費",
                spec: "マニフェスト",
                remark: "",
                qty: 1,
                unit: "式",
                price: 85000,
                amount: 85000,
                netRate: 0.95,
                netPrice: 80750,
                netAmount: 80750,
              },
            ],
            painting: [
              {
                type: "major",
                category: "外部塗装",
                amount: 12540000,
                netAmount: 9500000,
              },
              {
                type: "major",
                category: "内部塗装",
                amount: 8935000,
                netAmount: 7000000,
              },
              {
                type: "direct",
                category: "外部塗装",
                company: "株式会社 G社",
                item: "外壁塗装",
                spec: "シリコン樹脂塗料",
                remark: "2回塗り",
                qty: 3500,
                unit: "㎡",
                price: 2800,
                amount: 9800000,
                netRate: 0.93,
                netPrice: 2604,
                netAmount: 9114000,
              },
              {
                type: "direct",
                category: "外部塗装",
                company: "株式会社 G社",
                item: "軒天塗装",
                spec: "アクリル樹脂塗料",
                remark: "",
                qty: 450,
                unit: "㎡",
                price: 2200,
                amount: 990000,
                netRate: 0.93,
                netPrice: 2046,
                netAmount: 920700,
              },
              {
                type: "direct",
                category: "外部塗装",
                company: "株式会社 G社",
                item: "鉄部塗装",
                spec: "ウレタン樹脂塗料",
                remark: "錆止め含む",
                qty: 280,
                unit: "㎡",
                price: 3500,
                amount: 980000,
                netRate: 0.93,
                netPrice: 3255,
                netAmount: 911400,
              },
              {
                type: "indirect",
                category: "外部塗装",
                company: "株式会社 G社",
                item: "足場使用料",
                spec: "",
                remark: "外部足場",
                qty: 1,
                unit: "式",
                price: 650000,
                amount: 650000,
                netRate: 0.93,
                netPrice: 604500,
                netAmount: 604500,
              },
              {
                type: "legal",
                category: "外部塗装",
                company: "株式会社 G社",
                item: "有機溶剤作業主任者費",
                spec: "",
                remark: "法定資格",
                qty: 1,
                unit: "式",
                price: 120000,
                amount: 120000,
                netRate: 0.93,
                netPrice: 111600,
                netAmount: 111600,
              },
              {
                type: "direct",
                category: "内部塗装",
                company: "株式会社 H社",
                item: "壁面塗装",
                spec: "EP塗料",
                remark: "",
                qty: 4200,
                unit: "㎡",
                price: 1500,
                amount: 6300000,
                netRate: 0.94,
                netPrice: 1410,
                netAmount: 5922000,
              },
              {
                type: "direct",
                category: "内部塗装",
                company: "株式会社 H社",
                item: "天井塗装",
                spec: "EP塗料",
                remark: "",
                qty: 1800,
                unit: "㎡",
                price: 1200,
                amount: 2160000,
                netRate: 0.94,
                netPrice: 1128,
                netAmount: 2030400,
              },
              {
                type: "indirect",
                category: "内部塗装",
                company: "株式会社 H社",
                item: "養生費",
                spec: "",
                remark: "内装養生",
                qty: 1,
                unit: "式",
                price: 380000,
                amount: 380000,
                netRate: 0.94,
                netPrice: 357200,
                netAmount: 357200,
              },
              {
                type: "legal",
                category: "内部塗装",
                company: "株式会社 H社",
                item: "安全衛生経費",
                spec: "",
                remark: "法定",
                qty: 1,
                unit: "式",
                price: 95000,
                amount: 95000,
                netRate: 0.94,
                netPrice: 89300,
                netAmount: 89300,
              },
            ],
          },
        },
        {
          id: "p2",
          name: "新宿駅前 商業施設新築工事",
          shortName: "新宿駅前 商業施設...",
          type: "店舗",
          typeColor: "success",
          structure: "S造",
          area: "4,500",
          period: "2023/11/01 ~ 2024/03/31",
          totalEstimate: 450000000,
          totalNet: 398000000,
          data: {
            rebar: [
              {
                type: "major",
                category: "材料費",
                amount: 16943400,
                netAmount: 13700000,
              },
              {
                type: "major",
                category: "加工・組立費",
                amount: 15225500,
                netAmount: 11800000,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 I社",
                item: "異形棒鋼 SD295A",
                spec: "D10",
                remark: "",
                qty: 45.2,
                unit: "t",
                price: 112000,
                amount: 5062400,
                netRate: 0.95,
                netPrice: 106400,
                netAmount: 4809280,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 I社",
                item: "異形棒鋼 SD295A",
                spec: "D13",
                remark: "",
                qty: 62.8,
                unit: "t",
                price: 110000,
                amount: 6908000,
                netRate: 0.95,
                netPrice: 104500,
                netAmount: 6562600,
              },
              {
                type: "direct",
                category: "材料費",
                company: "株式会社 I社",
                item: "異形棒鋼 SD345",
                spec: "D19",
                remark: "",
                qty: 38.5,
                unit: "t",
                price: 118000,
                amount: 4543000,
                netRate: 0.95,
                netPrice: 112100,
                netAmount: 4315850,
              },
              {
                type: "indirect",
                category: "材料費",
                company: "株式会社 I社",
                item: "材料検査費",
                spec: "",
                remark: "ミルシート",
                qty: 1,
                unit: "式",
                price: 250000,
                amount: 250000,
                netRate: 0.95,
                netPrice: 237500,
                netAmount: 237500,
              },
              {
                type: "legal",
                category: "材料費",
                company: "株式会社 I社",
                item: "JIS規格適合証明費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 180000,
                amount: 180000,
                netRate: 0.95,
                netPrice: 171000,
                netAmount: 171000,
              },
              {
                type: "direct",
                category: "加工・組立費",
                company: "株式会社 J社",
                item: "鉄筋加工費",
                spec: "",
                remark: "工場加工",
                qty: 180.5,
                unit: "t",
                price: 36000,
                amount: 6498000,
                netRate: 0.92,
                netPrice: 33120,
                netAmount: 5978160,
              },
              {
                type: "direct",
                category: "加工・組立費",
                company: "株式会社 J社",
                item: "鉄筋組立費",
                spec: "",
                remark: "現場組立",
                qty: 180.5,
                unit: "t",
                price: 45000,
                amount: 8122500,
                netRate: 0.92,
                netPrice: 41400,
                netAmount: 7472700,
              },
              {
                type: "indirect",
                category: "加工・組立費",
                company: "株式会社 J社",
                item: "品質管理費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 420000,
                amount: 420000,
                netRate: 0.92,
                netPrice: 386400,
                netAmount: 386400,
              },
              {
                type: "legal",
                category: "加工・組立費",
                company: "株式会社 J社",
                item: "建設業退職金共済費",
                spec: "",
                remark: "法定",
                qty: 1,
                unit: "式",
                price: 185000,
                amount: 185000,
                netRate: 0.92,
                netPrice: 170200,
                netAmount: 170200,
              },
            ],
            earthwork: [
              {
                type: "major",
                category: "掘削工事",
                amount: 35410000,
                netAmount: 28000000,
              },
              {
                type: "major",
                category: "残土処分",
                amount: 16610000,
                netAmount: 13000000,
              },
              {
                type: "major",
                category: "埋戻し工事",
                amount: 8730000,
                netAmount: 6500000,
              },
              {
                type: "direct",
                category: "掘削工事",
                company: "株式会社 K社",
                item: "根切り工事",
                spec: "機械掘削",
                remark: "バックホウ0.7㎥",
                qty: 4500,
                unit: "㎥",
                price: 3200,
                amount: 14400000,
                netRate: 0.94,
                netPrice: 3008,
                netAmount: 13536000,
              },
              {
                type: "direct",
                category: "掘削工事",
                company: "株式会社 K社",
                item: "床付け工事",
                spec: "",
                remark: "",
                qty: 2200,
                unit: "㎡",
                price: 900,
                amount: 1980000,
                netRate: 0.94,
                netPrice: 846,
                netAmount: 1861200,
              },
              {
                type: "direct",
                category: "掘削工事",
                company: "株式会社 L社",
                item: "山留め工事",
                spec: "SMW工法",
                remark: "",
                qty: 520,
                unit: "m",
                price: 35000,
                amount: 18200000,
                netRate: 0.94,
                netPrice: 32900,
                netAmount: 17108000,
              },
              {
                type: "indirect",
                category: "掘削工事",
                company: "株式会社 K社",
                item: "測量費",
                spec: "",
                remark: "丁張設置",
                qty: 1,
                unit: "式",
                price: 350000,
                amount: 350000,
                netRate: 0.94,
                netPrice: 329000,
                netAmount: 329000,
              },
              {
                type: "legal",
                category: "掘削工事",
                company: "株式会社 K社",
                item: "地下水対策費",
                spec: "",
                remark: "法定届出",
                qty: 1,
                unit: "式",
                price: 480000,
                amount: 480000,
                netRate: 0.94,
                netPrice: 451200,
                netAmount: 451200,
              },
              {
                type: "direct",
                category: "残土処分",
                company: "株式会社 M社",
                item: "残土運搬",
                spec: "10tダンプ",
                remark: "",
                qty: 5800,
                unit: "㎥",
                price: 1900,
                amount: 11020000,
                netRate: 0.93,
                netPrice: 1767,
                netAmount: 10248600,
              },
              {
                type: "direct",
                category: "残土処分",
                company: "株式会社 M社",
                item: "残土処分費",
                spec: "汚染なし",
                remark: "",
                qty: 5800,
                unit: "㎥",
                price: 900,
                amount: 5220000,
                netRate: 0.93,
                netPrice: 837,
                netAmount: 4854600,
              },
              {
                type: "indirect",
                category: "残土処分",
                company: "株式会社 M社",
                item: "運搬車両管理費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 220000,
                amount: 220000,
                netRate: 0.93,
                netPrice: 204600,
                netAmount: 204600,
              },
              {
                type: "legal",
                category: "残土処分",
                company: "株式会社 M社",
                item: "産業廃棄物処理委託費",
                spec: "",
                remark: "法定",
                qty: 1,
                unit: "式",
                price: 150000,
                amount: 150000,
                netRate: 0.93,
                netPrice: 139500,
                netAmount: 139500,
              },
              {
                type: "direct",
                category: "埋戻し工事",
                company: "株式会社 N社",
                item: "埋戻し",
                spec: "山砂",
                remark: "転圧含む",
                qty: 1800,
                unit: "㎥",
                price: 4500,
                amount: 8100000,
                netRate: 0.92,
                netPrice: 4140,
                netAmount: 7452000,
              },
              {
                type: "indirect",
                category: "埋戻し工事",
                company: "株式会社 N社",
                item: "転圧試験費",
                spec: "",
                remark: "品質確認",
                qty: 1,
                unit: "式",
                price: 280000,
                amount: 280000,
                netRate: 0.92,
                netPrice: 257600,
                netAmount: 257600,
              },
              {
                type: "legal",
                category: "埋戻し工事",
                company: "株式会社 N社",
                item: "土壌汚染調査費",
                spec: "",
                remark: "法定調査",
                qty: 1,
                unit: "式",
                price: 350000,
                amount: 350000,
                netRate: 0.92,
                netPrice: 322000,
                netAmount: 322000,
              },
            ],
            painting: [
              {
                type: "major",
                category: "外部塗装",
                amount: 21734000,
                netAmount: 16800000,
              },
              {
                type: "major",
                category: "内部塗装",
                amount: 18145000,
                netAmount: 14500000,
              },
              {
                type: "direct",
                category: "外部塗装",
                company: "株式会社 O社",
                item: "外壁塗装",
                spec: "フッ素樹脂塗料",
                remark: "2回塗り",
                qty: 5200,
                unit: "㎡",
                price: 3500,
                amount: 18200000,
                netRate: 0.93,
                netPrice: 3255,
                netAmount: 16926000,
              },
              {
                type: "direct",
                category: "外部塗装",
                company: "株式会社 O社",
                item: "鉄部塗装",
                spec: "ウレタン樹脂塗料",
                remark: "錆止め含む",
                qty: 680,
                unit: "㎡",
                price: 3800,
                amount: 2584000,
                netRate: 0.93,
                netPrice: 3534,
                netAmount: 2403120,
              },
              {
                type: "indirect",
                category: "外部塗装",
                company: "株式会社 O社",
                item: "高所作業車費",
                spec: "",
                remark: "リース",
                qty: 1,
                unit: "式",
                price: 480000,
                amount: 480000,
                netRate: 0.93,
                netPrice: 446400,
                netAmount: 446400,
              },
              {
                type: "indirect",
                category: "外部塗装",
                company: "株式会社 O社",
                item: "飛散防止養生費",
                spec: "",
                remark: "",
                qty: 1,
                unit: "式",
                price: 320000,
                amount: 320000,
                netRate: 0.93,
                netPrice: 297600,
                netAmount: 297600,
              },
              {
                type: "legal",
                category: "外部塗装",
                company: "株式会社 O社",
                item: "特定化学物質作業主任者費",
                spec: "",
                remark: "法定",
                qty: 1,
                unit: "式",
                price: 150000,
                amount: 150000,
                netRate: 0.93,
                netPrice: 139500,
                netAmount: 139500,
              },
              {
                type: "direct",
                category: "内部塗装",
                company: "株式会社 P社",
                item: "壁面塗装",
                spec: "EP-G塗料",
                remark: "",
                qty: 8500,
                unit: "㎡",
                price: 1600,
                amount: 13600000,
                netRate: 0.935,
                netPrice: 1496,
                netAmount: 12716000,
              },
              {
                type: "direct",
                category: "内部塗装",
                company: "株式会社 P社",
                item: "天井塗装",
                spec: "EP塗料",
                remark: "",
                qty: 3200,
                unit: "㎡",
                price: 1300,
                amount: 4160000,
                netRate: 0.935,
                netPrice: 1215,
                netAmount: 3889600,
              },
              {
                type: "indirect",
                category: "内部塗装",
                company: "株式会社 P社",
                item: "換気設備費",
                spec: "",
                remark: "臭気対策",
                qty: 1,
                unit: "式",
                price: 180000,
                amount: 180000,
                netRate: 0.935,
                netPrice: 168300,
                netAmount: 168300,
              },
              {
                type: "indirect",
                category: "内部塗装",
                company: "株式会社 P社",
                item: "清掃費",
                spec: "",
                remark: "完了時",
                qty: 1,
                unit: "式",
                price: 120000,
                amount: 120000,
                netRate: 0.935,
                netPrice: 112200,
                netAmount: 112200,
              },
              {
                type: "legal",
                category: "内部塗装",
                company: "株式会社 P社",
                item: "消防届出費",
                spec: "",
                remark: "法定届出",
                qty: 1,
                unit: "式",
                price: 85000,
                amount: 85000,
                netRate: 0.935,
                netPrice: 79475,
                netAmount: 79475,
              },
            ],
          },
        },
      ];

      const state = {};

      function initProject(p) {
        state[p.id] = { cat: "rebar", sub: "" };
      }

      function renderProjects() {
        const container = document.getElementById("projectsContainer");
        container.innerHTML = projects
          .map((p) => {
            initProject(p);
            return `
                <div class="card shadow-sm mb-4" id="card-${p.id}">
                    <div class="card-header bg-white py-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <span class="badge text-bg-${
                                      p.typeColor
                                    }">${p.type}</span>
                                    <span class="badge text-bg-secondary">${
                                      p.structure
                                    }</span>
                                    <small class="text-muted d-flex align-items-center gap-1">${
                                      icons.expand
                                    } ${p.area}㎡</small>
                                </div>
                                <h5 class="fw-bold mb-1">${p.name}</h5>
                                <small class="text-muted">見積期間: ${
                                  p.period
                                }</small>
                            </div>
                            <button class="btn btn-link text-decoration-none p-0" onclick="toggleDetails('${
                              p.id
                            }')">
                                <span id="toggle-text-${
                                  p.id
                                }">見積詳細を開く</span>
                                <span id="toggle-icon-${p.id}">${
              icons.chevronDown
            }</span>
                            </button>
                        </div>
                        <div class="row g-3 mt-2">
                            <div class="col-12">
                                <div class="card summary-card">
                                    <div class="card-body py-2">
                                        <small class="text-muted fw-bold">案件の全体総計</small>
                                        <div class="d-flex gap-4 mt-1">
                                            <div>
                                                <small class="text-muted d-block">見積総計金額</small>
                                                <span class="fw-bold tabular-nums">¥${fmt(
                                                  p.totalEstimate
                                                )}</span>
                                            </div>
                                            <div>
                                                <small class="text-primary fw-bold d-block">NET総計金額</small>
                                                <span class="fw-bold text-primary fs-5 tabular-nums">¥${fmt(
                                                  p.totalNet
                                                )}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="details-${p.id}">
                        <nav class="px-3 py-2 border-bottom bg-light">
                            <ol class="breadcrumb mb-0 small">
                                <li class="breadcrumb-item text-muted">${
                                  p.shortName
                                }</li>
                                <li class="breadcrumb-item text-muted" id="bc-cat-${
                                  p.id
                                }">鉄筋工事</li>
                                <li class="breadcrumb-item active" id="bc-sub-${
                                  p.id
                                }">-</li>
                            </ol>
                        </nav>
                        <div class="bg-white border-bottom">
                            <ul class="nav nav-tabs px-3" id="categoryTabs-${
                              p.id
                            }" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" type="button" role="tab" data-cat="rebar" onclick="switchCategory('${
                                      p.id
                                    }','rebar',this)">鉄筋工事</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" type="button" role="tab" data-cat="earthwork" onclick="switchCategory('${
                                      p.id
                                    }','earthwork',this)">土工事</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" type="button" role="tab" data-cat="painting" onclick="switchCategory('${
                                      p.id
                                    }','painting',this)">塗装工事</button>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-light border-bottom px-3 py-3">
                            <small class="text-muted fw-bold d-flex align-items-center gap-1 mb-2">${
                              icons.filter
                            } 大分類を選択</small>
                            <div class="d-flex gap-2 scroll-x pb-1" id="subcategoryContainer-${
                              p.id
                            }"></div>
                        </div>
                        <div class="px-3 py-3 d-none" id="selectionCard-${
                          p.id
                        }">
                            <div class="card">
                                <div class="card-body py-2">
                                    <small class="text-muted fw-bold">選択工種の内訳: <span class="text-dark" id="selectionName-${
                                      p.id
                                    }"></span></small>
                                    <div class="row g-2 mt-1">
                                        <div class="col-4 col-md-2"><small class="text-muted d-block">見積金額</small><span class="fw-bold tabular-nums" id="selectionEstimate-${
                                          p.id
                                        }">-</span></div>
                                        <div class="col-4 col-md-2"><small class="text-primary fw-bold d-block">NET金額</small><span class="fw-bold text-primary tabular-nums" id="selectionNet-${
                                          p.id
                                        }">-</span></div>
                                        <div class="col-4 col-md-2"><small class="text-success fw-bold d-block">NET率(掛け率)</small><span class="fw-bold text-success tabular-nums" id="selectionNetRate-${
                                          p.id
                                        }">-</span></div>
                                        <div class="col-4 col-md-2"><small class="text-muted d-block">直接費</small><span class="tabular-nums" id="selectionDirect-${
                                          p.id
                                        }">-</span></div>
                                        <div class="col-4 col-md-2"><small class="text-muted d-block">間接費</small><span class="tabular-nums" id="selectionIndirect-${
                                          p.id
                                        }">-</span></div>
                                        <div class="col-4 col-md-2"><small class="text-muted d-block">法定福利費</small><span class="tabular-nums" id="selectionLegal-${
                                          p.id
                                        }">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-3">
                            <div class="table-responsive border rounded" style="max-height:400px;overflow:auto">
                                <table class="table table-estimate table-hover table-striped mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="text-center" style="width:70px">種別</th>
                                            <th style="min-width:140px">協力会社名</th>
                                            <th style="min-width:180px">品目</th>
                                            <th style="min-width:120px">仕様</th>
                                            <th style="min-width:100px">備考</th>
                                            <th class="text-end" style="width:80px">数量</th>
                                            <th class="text-center" style="width:50px">単位</th>
                                            <th class="text-end col-price" style="width:100px">単価</th>
                                            <th class="text-end col-price" style="width:120px">金額</th>
                                            <th class="text-end col-net" style="width:70px">NET率</th>
                                            <th class="text-end col-net" style="width:100px">NET単価</th>
                                            <th class="text-end col-net" style="width:120px">NET金額</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detailTbody-${p.id}"></tbody>
                                </table>
                                <div id="noDataMsg-${
                                  p.id
                                }" class="text-center text-muted py-5 d-none">${
              icons.inbox
            }<div class="mt-2">データがありません</div></div>
                            </div>
                        </div>
                    </div>
                </div>`;
          })
          .join("");
        projects.forEach((p) => buildSubcategories(p.id));
      }

      function toggleDetails(pid) {
        const el = document.getElementById(`details-${pid}`);
        const text = document.getElementById(`toggle-text-${pid}`);
        const icon = document.getElementById(`toggle-icon-${pid}`);
        if (el.classList.contains("show")) {
          el.classList.remove("show");
          text.textContent = "見積詳細を開く";
          icon.innerHTML = icons.chevronDown;
        } else {
          el.classList.add("show");
          text.textContent = "見積詳細を閉じる";
          icon.innerHTML = icons.chevronUp;
        }
      }

      function switchCategory(pid, cat, btn) {
        state[pid].cat = cat;
        document
          .querySelectorAll(`#categoryTabs-${pid} .nav-link`)
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(`bc-cat-${pid}`).textContent = catNames[cat];
        buildSubcategories(pid);
      }

      function buildSubcategories(pid) {
        const p = projects.find((x) => x.id === pid);
        const c = document.getElementById(`subcategoryContainer-${pid}`);
        const majors = p.data[state[pid].cat].filter((d) => d.type === "major");
        c.innerHTML = "";

        // 「すべて」ボタンを最初に追加
        const allData = p.data[state[pid].cat].filter(
          (d) => d.type !== "major"
        );
        const allNetSum = allData.reduce((s, r) => s + (r.netAmount || 0), 0);
        const allBtn = document.createElement("button");
        allBtn.className = "btn btn-outline-secondary subcategory-btn active";
        allBtn.innerHTML = `<span class="sub-label d-block">すべて</span><span class="sub-amount tabular-nums">¥${fmt(
          allNetSum
        )}</span>`;
        allBtn.onclick = () => {
          c.querySelectorAll(".subcategory-btn").forEach((b) =>
            b.classList.remove("active")
          );
          allBtn.classList.add("active");
          selectSub(pid, "all", null);
        };
        c.appendChild(allBtn);

        majors.forEach((m, i) => {
          const btn = document.createElement("button");
          btn.className = "btn btn-outline-secondary subcategory-btn";
          btn.innerHTML = `<span class="sub-label d-block">${
            m.category
          }</span><span class="sub-amount tabular-nums">¥${fmt(
            m.netAmount
          )}</span>`;
          btn.onclick = () => {
            c.querySelectorAll(".subcategory-btn").forEach((b) =>
              b.classList.remove("active")
            );
            btn.classList.add("active");
            selectSub(pid, m.category, m);
          };
          c.appendChild(btn);
        });

        // 初期表示は「すべて」
        state[pid].sub = "all";
        selectSub(pid, "all", null);
      }

      function selectSub(pid, sub, m) {
        state[pid].sub = sub;
        const p = projects.find((x) => x.id === pid);
        const isAll = sub === "all";

        document.getElementById(`bc-sub-${pid}`).textContent = isAll
          ? "すべて"
          : sub;
        document
          .getElementById(`selectionCard-${pid}`)
          .classList.remove("d-none");
        document.getElementById(`selectionName-${pid}`).textContent = isAll
          ? "すべて"
          : sub;

        // 「すべて」の場合は全明細、それ以外は該当カテゴリのみ
        const details = isAll
          ? p.data[state[pid].cat].filter((r) => r.type !== "major")
          : p.data[state[pid].cat].filter(
              (r) => r.category === sub && r.type !== "major"
            );

        const directSum = details
          .filter((r) => r.type === "direct")
          .reduce((s, r) => s + (r.netAmount || 0), 0);
        const indirectSum = details
          .filter((r) => r.type === "indirect")
          .reduce((s, r) => s + (r.netAmount || 0), 0);
        const legalSum = details
          .filter((r) => r.type === "legal")
          .reduce((s, r) => s + (r.netAmount || 0), 0);
        const totalAmount = details.reduce((s, r) => s + (r.amount || 0), 0);
        const totalNet = directSum + indirectSum + legalSum;

        document.getElementById(`selectionEstimate-${pid}`).textContent = isAll
          ? `¥${fmt(totalAmount)}`
          : m
          ? `¥${fmt(m.amount)}`
          : "-";
        document.getElementById(`selectionNet-${pid}`).textContent = isAll
          ? `¥${fmt(totalNet)}`
          : m
          ? `¥${fmt(m.netAmount)}`
          : "-";

        const netRate =
          totalAmount > 0 ? (totalNet / totalAmount).toFixed(3) : "-";
        document.getElementById(`selectionNetRate-${pid}`).textContent =
          netRate;
        document.getElementById(`selectionDirect-${pid}`).textContent = `¥${fmt(
          directSum
        )}`;
        document.getElementById(
          `selectionIndirect-${pid}`
        ).textContent = `¥${fmt(indirectSum)}`;
        document.getElementById(`selectionLegal-${pid}`).textContent = `¥${fmt(
          legalSum
        )}`;
        renderTable(pid);
      }

      function renderTable(pid) {
        const p = projects.find((x) => x.id === pid);
        const tb = document.getElementById(`detailTbody-${pid}`);
        const msg = document.getElementById(`noDataMsg-${pid}`);
        const isAll = state[pid].sub === "all";

        // 「すべて」の場合は全明細、それ以外は該当カテゴリのみ
        const data = isAll
          ? p.data[state[pid].cat].filter((r) => r.type !== "major")
          : p.data[state[pid].cat].filter(
              (r) => r.category === state[pid].sub && r.type !== "major"
            );

        tb.innerHTML = "";
        if (!data.length) {
          msg.classList.remove("d-none");
          return;
        }
        msg.classList.add("d-none");
        data.forEach((r) => {
          const badge =
            r.type === "direct"
              ? "primary"
              : r.type === "indirect"
              ? "warning"
              : "danger";
          const label =
            r.type === "direct"
              ? "直接費"
              : r.type === "indirect"
              ? "間接費"
              : "法定費";
          tb.innerHTML += `<tr>
                    <td class="text-center"><span class="badge text-bg-${badge}">${label}</span></td>
                    <td>${r.company || "-"}</td><td class="fw-medium">${
            r.item
          }</td><td>${r.spec || ""}</td><td class="text-muted small">${
            r.remark || ""
          }</td>
                    <td class="text-end tabular-nums">${fmt(
                      r.qty
                    )}</td><td class="text-center small text-muted">${
            r.unit
          }</td>
                    <td class="text-end tabular-nums col-price text-muted">${fmt(
                      r.price
                    )}</td><td class="text-end tabular-nums col-price text-muted">${fmt(
            r.amount
          )}</td>
                    <td class="text-end tabular-nums col-net fw-bold">${r.netRate.toFixed(
                      3
                    )}</td>
                    <td class="text-end tabular-nums col-net fw-bold">${fmt(
                      r.netPrice
                    )}</td>
                    <td class="text-end tabular-nums col-net fw-bold">${fmt(
                      r.netAmount
                    )}</td>
                </tr>`;
        });
      }

      renderProjects();
    </script>
  </body>
</html>
